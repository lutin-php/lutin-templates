# AGENTS.md — Lutin-Templates Repository

## Project Overview

**Lutin-Templates** is a centralized repository system for managing, building, and distributing project templates (boilerplates) for the Lutin.php ecosystem.

### Purpose

- Package template folders into `.zip` files
- Generate a JSON manifest (`templates.json`) that serves as an API
- Use GitHub Releases for distribution

---

## Repository Layout

```
lutin-templates/
├── .github/workflows/build-releases.yml  # CI/CD: Builds releases on push to main
├── scripts/
│   └── build-zips.php                    # PHP build script (generates ZIPs + manifest)
├── templates/                            # Source project templates
│   └── blog-static/                      # Example template (flat-file blog)
│       ├── public/                       # Web-accessible files (goes to webroot)
│       ├── src/                          # Private PHP logic
│       ├── data/                         # Private data (posts, SQLite, etc.)
│       └── lutin/
│           └── AGENTS.md                 # AI guidance for this specific template
├── dist/                                 # Generated ZIP files (git-ignored)
└── templates.json                        # Generated manifest (API for remote Lutin)
```

---

## Development Workflow

### Adding a New Template

1. **Create directory** in `templates/` with kebab-case name:
   ```bash
   mkdir templates/my-new-template
   ```

2. **Follow the Public/Private Split**:
   - `public/` — Everything browser-accessible (index.php, CSS, JS, images)
   - `src/` — Private PHP classes/functions
   - `data/` — Private data storage
   - `lutin/AGENTS.md` — Documentation for the AI agent

3. **Add metadata** (optional):
   - Create `metadata.json` in the template root, OR
   - Ensure `lutin/AGENTS.md` has a clear H1 title and first paragraph description

4. **Test locally**:
   ```bash
   php scripts/build-zips.php
   ```

5. **Commit and push** — GitHub Actions will create the release automatically

### Build Script Behavior

`scripts/build-zips.php`:
- Requires PHP 8.1+ with `zip` extension
- Reads all directories from `templates/`
- Creates `dist/{template-name}.zip` for each
- Calculates SHA-256 hash for integrity verification
- Generates `templates.json` with:
  - `id` — Directory name
  - `name` — From metadata or prettified directory name
  - `description` — From metadata or default
  - `hash` — SHA-256 of the ZIP
  - `download_url` — GitHub Releases URL

---

## Template Architecture Requirements

Every template MUST follow this structure:

```
templates/{name}/
├── public/              # Required: Web root contents
│   └── index.php        # Required: Entry point
├── lutin/
│   └── AGENTS.md        # Required: AI guidance
└── [other dirs]/        # Optional: Private files
```

### The Public/Private Split

This is critical for security:

- **`public/`** — Contents are extracted to the webroot (where `lutin.php` lives)
- **Everything else** — Extracted outside webroot, as siblings to the data directory

When Lutin.php installs a template:
1. Downloads the ZIP from GitHub Releases
2. Extracts `public/` to the webroot
3. Extracts other folders to appropriate locations based on permissions
4. Reads `lutin/AGENTS.md` to initialize the AI context

### AGENTS.md Philosophy

The `AGENTS.md` inside a template is **not documentation about the template** — it becomes permanent documentation **for the end user's project**. After installation, the user will continue referencing this file as they maintain and evolve their project.

**Write AGENTS.md as if addressing the project owner, not a template shopper:**

- ❌ "This template provides a minimal blog..."
- ✅ "This is your flat-file blog..."

- ❌ "The template includes a public folder..."
- ✅ "Your web-accessible files are in public/..."

- ❌ "To customize this template..."
- ✅ "To customize your site..."

This ensures the documentation remains relevant and useful long after the initial setup.

---

## GitHub Actions Workflow

**Trigger**: Push to `main` branch or manual dispatch

**Steps**:
1. Setup PHP with zip extension
2. Run `build-zips.php`
3. Upload ZIP artifacts
4. Create GitHub Release with version tag
5. Upload ZIP files as release assets
6. Update `templates.json` with correct download URLs
7. Commit updated manifest back to repo

---

## Coding Standards

- **PHP 8.1+** for build scripts
- **Zero Composer dependencies** — use only built-in PHP functions
- Template names use **kebab-case** (e.g., `blog-static`, `portfolio-minimal`)
- All paths use `/` forward slashes (normalized for cross-platform)

---

## Security Considerations

1. **Never commit `dist/`** — it's git-ignored and regenerated by CI
2. **Validate filenames** in templates — no special characters that could break ZIPs
3. **SHA-256 hashes** are included in manifest for integrity verification
4. **Template isolation** — each template is a separate ZIP, no cross-template dependencies

---

## Key Implementation Notes

- The `templates.json` acts as a public API: `https://raw.githubusercontent.com/USER/REPO/main/templates.json`
- Remote Lutin instances fetch this manifest to show available templates
- Version in manifest follows Git tag (e.g., `v2026.02.16-abc123` or `v1.0.0`)
- Download URLs point to GitHub Release assets, not the repository files

---

## Testing

This repository includes a lightweight custom test framework (no external dependencies).

### Running Tests

```bash
php scripts/run-tests.php
```

### Test Structure

```
tests/
├── bootstrap.php       # Test initialization
├── TestCase.php        # Base test class (PHPUnit-like API)
├── run-tests.php       # Test runner script
└── BuildScriptTest.php # Tests for build-zips.php
```

### Writing New Tests

Create a class extending `TestCase` with methods starting with `test`:

```php
<?php
declare(strict_types=1);

namespace LutinTemplates\Tests;

class MyFeatureTest extends TestCase
{
    protected function setUp(): void
    {
        // Run before each test
    }

    protected function tearDown(): void
    {
        // Run after each test
    }

    public function testSomething(): void
    {
        $this->assertTrue(true);
        $this->assertEquals('expected', 'actual');
    }
}
```

### Available Assertions

- `assertTrue($condition, $message)`
- `assertFalse($condition, $message)`
- `assertEquals($expected, $actual, $message)`
- `assertNotEmpty($actual, $message)`
- `assertEmpty($actual, $message)`
- `assertStringContainsString($needle, $haystack, $message)`
- `assertStringStartsWith($prefix, $string, $message)`
- `assertStringEndsWith($suffix, $string, $message)`
- `assertFileExists($filename, $message)`
- `assertFileDoesNotExist($filename, $message)`
- `assertIsArray($actual, $message)`
- `assertIsInt($actual, $message)`
- `assertIsString($actual, $message)`
- `assertGreaterThan($expected, $actual, $message)`
- `assertJson($json, $message)`
- `assertArrayHasKey($key, $array, $message)`
- `assertInstanceOf($expected, $actual, $message)`

---

## Adding Example Content

Templates should include minimal example content to demonstrate functionality:

- **blog-static**: Include 1-2 sample posts in `data/posts/`
- **portfolio**: Include placeholder projects
- **e-commerce**: Include sample products (not real data)

Keep examples lightweight — users will replace them.
